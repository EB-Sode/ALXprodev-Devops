#!/bin/bash
# Script: get_multiple_pokemon.sh
# Description: Fetch data for multiple Pok√©mon from the Pok√©API with retry and error handling.

# List of Pok√©mon
POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# API base URL
API_URL="https://pokeapi.co/api/v2/pokemon"

# Output and log files
ERROR_FILE="errors.txt"

# Clear old error log
> "$ERROR_FILE"

# Retry limit
MAX_RETRIES=3

# Loop through each Pok√©mon
for name in "${POKEMONS[@]}"; do
  echo "üîé Fetching data for $name..."

  success=false
  attempt=1

  # Retry loop
  while [ $attempt -le $MAX_RETRIES ]; do
    echo "   Attempt $attempt..."

    # Perform API request
    response_code=$(curl -s -w "%{http_code}" -o "${name}.json" "${API_URL}/${name}")

    # Check if the response is successful
    if [ "$response_code" -eq 200 ]; then
      echo "‚úÖ Successfully saved ${name}.json"
      success=true
      break
    else
      echo "‚ö†Ô∏è Failed (HTTP $response_code). Retrying in 3s..."
      sleep 3
      attempt=$((attempt + 1))
    fi
  done

  # If all attempts failed
  if [ "$success" = false ]; then
    echo "‚ùå Could not fetch data for $name after $MAX_RETRIES attempts" | tee -a "$ERROR_FILE"
  fi

  # Delay between Pok√©mon to avoid rate limiting
  sleep 2
done

echo
echo "üéØ Fetch process complete!"
echo "Check '$ERROR_FILE' for any failed requests."
